@*// *********************************************************************************************************
    //  View Name                : Form4ViewWithDSC
    //  Desciption               : To Issue Acknowledgement
    //  Created By               : Akshaya Dalei
    //  Created On               : 24 July 2021
    // ********************************************************************************************************
*@

@{
    ViewBag.Title = "Form 4 With DSC";
    Layout = "~/Views/Shared/_CMSLayout.cshtml";
}
@using userregistrationEF;
@using Microsoft.Extensions.Options;
@inject IOptions<KeyList> objKeyList
@using userregistrationApp.Helper;
@model userregistrationEF.LicenseApplication
<style>
    #Calculation {
        text-align: center;
        position: absolute;
        white-space: nowrap;
        padding: 1em;
        cursor: pointer;
    }
</style>

<section class="wrapper main-wrapper row">
    <div class="col-12">
        @Html.Partial("_CMSnavigation")
        <!-- MAIN CONTENT AREA STARTS -->
        <div class="row">
            <div class="col-12">
                <div class="main-tab">
                    <ul class="nav nav-tabs">
                        <li class="nav-item">
                            <a class="nav-link active" href="javascript:void(0)">
                                Form 4 - Review
                            </a>

                        </li>
                    </ul>
                    @Html.Partial("_CMSutil")
                </div>

                <section class="box form-container">
                    <div class="content-body">
                        <div class="table-responsive" id="divPrint" style="margin-bottom: 1rem;">

                            @(Html.HiddenFor(model => model.LicenseAppId))
                            @(Html.HiddenFor(model => model.PaymentRecieptId))
                            @(Html.HiddenFor(model => model.DSCLesseeFilePath))
                            <table id="tablePRint" style="border: 1px solid #dadada;width: 100%;">
                                <tr>
                                    <td style="border: 1px solid #ddd; padding: 10px;">
                                        <img id="imgLogo" src="/CMSimg/govt-logo.png" style="height: 100px; width: 100px; margin: 0 auto; display: block;" alt="LOGO">
                                        <br>
                                        <h2 style="text-align: center;">MINERAL RESOURCES DEPARTMENT</h2>
                                        <h5 style="text-align: center;color:red">GOVERNMENT OF CHHATTISGARH</h5>

                                    </td>
                                </tr>
                            </table>
                            <table id="tablePRint2" style="border: 1px solid #dadada;width: 100%;">
                                <tbody>

                                    <tr>
                                        <td colspan="3" style="border: 1px solid #ddd; padding: 10px; text-align: center;">
                                            <span class="lead" style="font-size: 16px; text-align: center">Form 4 (फॉर्म 4)</span>
                                            <br />
                                            <span class="lead" style="font-size: 16px; text-align: center">Application for Grant/Renewal of Temporary Storage/Beneficiation/Crusher Permit</span>
                                            <br />

                                            <span class="lead" style="font-size: 14px; text-align: center">अस्थाई संग्रहण / लाभकारी / कुचल संयंत्र लाइसेंस के लिए आवेदन</span>
                                            <br />
                                            <span class="lead" style="font-size: 16px; text-align: center">[Rule 7(1) of CG Mineral(Mining Transportation and Storage)Rules,2009] </span>
                                            <br />
                                            <span class="lead" style="font-size: 14px; text-align: center"> खनिज (खनन परिवहन और भंडारण) नियम, 2009 के नियम 7 (1)</span>

                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>1</span>
                                        </td>
                                        <td style="border: 1px solid #ddd; padding: 10px;"><span>Name of Minerals (खनिज का नाम)</span> </td>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>@Model.MineralName</span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>2</span>
                                        </td>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>
                                                Quantity in tonne (Maximum capacity of Store at a time)<br />
                                                टन में मात्रा (एक समय में स्टोर की अधिकतम क्षमता)
                                            </span>
                                        </td>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>@Model.StorageCapicity</span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>3</span>
                                        </td>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>Period (अवधि) </span>
                                        </td>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>@Model.Period</span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>4</span>
                                        </td>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>Place (स्थान)</span>
                                        </td>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>@Model.Place</span>
                                        </td>

                                    </tr>


                                    <tr>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>5</span>
                                        </td>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>Name of Applicant (आवेदक का नाम)</span>
                                        </td>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>@Model.ApplicantName</span>
                                        </td>

                                    </tr>

                                    <tr>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>6</span>
                                        </td>
                                        <td colspan="2" style="border: 1px solid #ddd; padding: 10px;">
                                            <span>Complete Address (पूरा पता)</span>
                                        </td>

                                    </tr>

                                    <tr>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span></span>
                                        </td>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>1)   Address (पता)</span>
                                        </td>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>@Model.CompleteAddress</span>
                                        </td>

                                    </tr>
                                    <tr>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span></span>
                                        </td>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>2)   Village (गाँव)</span>
                                        </td>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>@Model.VillageName</span>
                                        </td>
                                    </tr>

                                    <tr>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span></span>
                                        </td>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>3)   Tehsil (तहसील)</span>
                                        </td>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>@Model.TehsilName</span>
                                        </td>
                                    </tr>

                                    <tr>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span></span>
                                        </td>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>4)   District (जिला)</span>
                                        </td>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>@Model.DistrictName</span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span></span>
                                        </td>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>5)   Panchayat (पंचायत)</span>
                                        </td>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>@Model.Panchayat</span>
                                        </td>
                                    </tr>

                                    <tr>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span></span>
                                        </td>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>6)   Police Station (पुलिस स्टेशन)</span>
                                        </td>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>@Model.PoliceStation</span>
                                        </td>
                                    </tr>

                                    <tr>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>7</span>
                                        </td>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>Applicant is (आवेदक है)</span>
                                        </td>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>@Model.ApplicantType</span>
                                        </td>

                                    </tr>

                                    <tr>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>8</span>
                                        </td>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>Profession or nature of business (पेशे या व्यवसाय की प्रकृति)</span>
                                        </td>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>@Model.NatureofBusiness</span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>9</span>
                                        </td>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>No Mining Due Certificate (No माइनिंग ड्यू सर्टिफिकेट)</span>
                                        </td>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            @if (string.IsNullOrEmpty(Model.AppliedName))
                                            {
                                                <span><a class="text-primary" href="/FORM4/NO_DUE/@Model.NO_MINING_DUE_CERTIFICATE_FILE_NAME" target="_blank"> <i class="icon-file-pdf-solid h4 text-danger"></i></a></span>
                                            }
                                            else
                                            {
                                                <span><a class="text-primary" href="@objKeyList.Value.MasterUrl/FORM4/NO_DUE/@Model.NO_MINING_DUE_CERTIFICATE_FILE_NAME" target="_blank"> <i class="icon-file-pdf-solid h4 text-danger"></i></a></span>
                                            }
                                        </td>

                                    </tr>
                                    <tr>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>10</span>
                                        </td>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>
                                                Affidavit stating that the applicant does not hold any mineral concession/license in the state<br />
                                                (एफ़ेडेविट बताते हुए कि आवेदक राज्य में कोई खनिज रियायत / लाइसेंस नहीं रखता है)
                                            </span>
                                        </td>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            @if (string.IsNullOrEmpty(Model.AppliedName))
                                            {
                                                <span><a class="text-primary" href="/FORM4/Affidavit_Mineral_Concession/@Model.AFFIDAVITE_FILE_NAME" target="_blank"><i class="icon-file-pdf-solid h4 text-danger"></i></a></span>
                                            }
                                            else
                                            {
                                                <span><a class="text-primary" href="@objKeyList.Value.MasterUrl/FORM4/Affidavit_Mineral_Concession/@Model.AFFIDAVITE_FILE_NAME" target="_blank"><i class="icon-file-pdf-solid h4 text-danger"></i></a></span>
                                            }
                                        </td>

                                    </tr>
                                    <tr>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>11</span>
                                        </td>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>
                                                Mineral/Ore or its product for which the applicant intend to hold a permit<br />
                                                (खनिज / अयस्क या उसके उत्पाद जिसके लिए आवेदक परमिट रखने का इरादा है)
                                            </span>
                                        </td>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>@Model.IntendMineralProductName</span>
                                        </td>
                                    </tr>

                                    <tr>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>12</span>
                                        </td>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>
                                                Affidavit showing the mineral concession/licenses held or being held by other person/persons jointly with the applicant <br />
                                                (आवेदक के साथ संयुक्त रूप से आयोजित दूसरे व्यक्ति / व्यक्ति द्वारा आयोजित या आयोजित होने वाले खनिज रियायत / लाइसेंस दिखाए गए शपथ पत्र)
                                            </span>
                                        </td>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            @if (string.IsNullOrEmpty(Model.AppliedName))
                                            {
                                                <span><a class="text-primary" href="/FORM4/Affidavit_Mineral_Jointly/@Model.AFFIDAVITE_JOINTLY_FILE_NAME" target="_blank"><i class="icon-file-pdf-solid h4 text-danger"></i></a></span>
                                            }
                                            else
                                            {
                                                <span><a class="text-primary" href="@objKeyList.Value.MasterUrl/FORM4/Affidavit_Mineral_Jointly/@Model.AFFIDAVITE_JOINTLY_FILE_NAME" target="_blank"><i class="icon-file-pdf-solid h4 text-danger"></i></a></span>
                                            }
                                        </td>
                                    </tr>

                                    <tr>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>13</span>
                                        </td>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>
                                                Certified copy of the map.
                                                (नक्शा की प्रमाणित प्रति)
                                            </span>
                                        </td>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            @if (string.IsNullOrEmpty(Model.AppliedName))
                                            {
                                                <span><a class="text-primary" href="/FORM4/Certified_Map/@Model.MAP_LAND_CERTIFICATE_FILE_NAME" target="_blank"><i class="icon-file-pdf-solid h4 text-danger"></i></a></span>
                                            }
                                            else
                                            {
                                                <span><a class="text-primary" href="@objKeyList.Value.MasterUrl/FORM4/Certified_Map/@Model.MAP_LAND_CERTIFICATE_FILE_NAME" target="_blank"><i class="icon-file-pdf-solid h4 text-danger"></i></a></span>
                                            }
                                        </td>
                                    </tr>

                                    <tr>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>14</span>
                                        </td>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>
                                                Latest revenue record of the land intended to be used for storing mineral or its products.
                                                <br />
                                                (खनिज या उसके उत्पादों को भंडारण के लिए इस्तेमाल किए जाने वाले भूमि का नवीनतम राजस्व रिकॉर्ड)
                                            </span>
                                        </td>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            @if (string.IsNullOrEmpty(Model.AppliedName))
                                            {
                                                <span><a class="text-primary" href="/FORM4/LatestRevenew/@Model.LATEST_REVENEW_CERTIFICATE_FILE_NAME" target="_blank"><i class="icon-file-pdf-solid h4 text-danger"></i></a></span>
                                            }
                                            else
                                            {
                                                <span><a class="text-primary" href="@objKeyList.Value.MasterUrl/FORM4/LatestRevenew/@Model.LATEST_REVENEW_CERTIFICATE_FILE_NAME" target="_blank"><i class="icon-file-pdf-solid h4 text-danger"></i></a></span>
                                            }
                                        </td>
                                    </tr>

                                    <tr>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>15</span>
                                        </td>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>
                                                Affidavit showing the surface rights/consent of the owner of the land, in case the applicant is not the owner of the land<br />
                                                (जमीन के मालिक की सतह के अधिकार / सहमति दिखाते हुए शपथ पत्र, यदि आवेदक भूमि का स्वामी नहीं है तो)
                                            </span>
                                        </td>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            @if (string.IsNullOrEmpty(Model.AppliedName))
                                            {
                                                <span><a class="text-primary" href="/FORM4/Affidavit_Land/@Model.OWNER_LAND_CERTIFICATE_FILE_NAME" target="_blank"><i class="icon-file-pdf-solid h4 text-danger"></i></a></span>
                                            }
                                            else
                                            {
                                                <span><a class="text-primary" href="@objKeyList.Value.MasterUrl/FORM4/Affidavit_Land/@Model.OWNER_LAND_CERTIFICATE_FILE_NAME" target="_blank"><i class="icon-file-pdf-solid h4 text-danger"></i></a></span>
                                            }
                                        </td>
                                    </tr>

                                    <tr>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>16</span>
                                        </td>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>
                                                Any other details the applicant wants to provide [NOC from PCB etc] (कोई भी अन्य विवरण आवेदक पीसीबी आदि से [एनओसी प्रदान करना चाहता है])

                                            </span>
                                        </td>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            @if (string.IsNullOrEmpty(Model.AppliedName))
                                            {
                                                <span><a class="text-primary" href="/FORM4/NOC_Certificate/@Model.NOC_OTHER_CERTIFICATE_FILE_NAME" target="_blank"><i class="icon-file-pdf-solid h4 text-danger"></i></a></span>
                                            }
                                            else
                                            {
                                                <span><a class="text-primary" href="@objKeyList.Value.MasterUrl/FORM4/NOC_Certificate/@Model.NOC_OTHER_CERTIFICATE_FILE_NAME" target="_blank"><i class="icon-file-pdf-solid h4 text-danger"></i></a></span>
                                            }
                                        </td>
                                    </tr>

                                    <tr>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>17</span>
                                        </td>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>Application Fees Payment Receipt ID (आवेदन शुल्क भुगतान रसीद आईडी)</span>
                                        </td>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span> @Model.PaymentRecieptId</span>
                                        </td>
                                    </tr>


                                    <tr>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>18</span>
                                        </td>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>Generated Date and Time (दिनांक और समय)</span>
                                        </td>
                                        <td style="border: 1px solid #ddd; padding: 10px;">
                                            <span>@(System.DateTime.Now.ToString("dd/MM/yyyy hh:mm:ss tt"))</span>
                                        </td>
                                    </tr>

                                    <tr>
                                        <td colspan="3" style="border: 1px solid #ddd; padding: 10px;">
                                            <label>
                                                <i>This is a system generated form. So physical signature is not required. </i>
                                            </label>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>

                        </div>
                        <div class="row">
                            <div class="col-sm-12 ">
                                <a href="javascript:void(0);" id="btnPrint" title="Print" onclick="DownloadForm();" class="btn btn-success btn-md ml-0 mb-2  waves-effect waves-light rounded-0">print</a>
                                <a href="javascript:void(0);" title="Issue Acknowledgement" id="btnSave" onclick="getPDF();" class="btn btn-success btn-md  mb-2  waves-effect waves-light rounded-0">Issue Acknowledgement</a>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>
</section>

<input id="fName" type="hidden" />
<input id="fid" type="hidden" />
@*<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.3/jspdf.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.js"></script>*@
<script src="~/CMSjs/jquery-1.12.4.js"></script>
<script src="~/CMSjs/jspdf.min.js"></script>
<script src="~/CMSjs/html2canvas.js"></script>
<script>
    $(document).ready(function () { loadNavigation('Form4ViewWithDSC', 'ql', 'pl', 'tl', 'License', 'Form4ViewWithDSC', ' '); });

    function DownloadForm() {
        debugger;
        var HTML_Width = $("#divPrint").width();
        var HTML_Height = $("#divPrint").height();
        var top_left_margin = 15;
        var PDF_Width = HTML_Width + (top_left_margin * 2);
        var PDF_Height = (PDF_Width * 1.5) + (top_left_margin * 2);
        var canvas_image_width = HTML_Width;
        var canvas_image_height = HTML_Height;

        var totalPDFPages = Math.ceil(HTML_Height / PDF_Height) - 1;


        html2canvas($("#divPrint")[0], { allowTaint: true }).then(function (canvas) {
            debugger;
            canvas.getContext('2d');

            console.log(canvas.height + "  " + canvas.width);


            var data = canvas.toDataURL("image/JPEG", 1.0);
            var pdf = new jsPDF('p', 'pt', [PDF_Width, PDF_Height]);
            pdf.addImage(data, 'JPEG', top_left_margin, top_left_margin, canvas_image_width, canvas_image_height);


            for (var i = 1; i <= totalPDFPages; i++) {
                pdf.addPage(PDF_Width, PDF_Height);
                pdf.addImage(data, 'JPEG', top_left_margin, -(PDF_Height * i) + (top_left_margin * 4), canvas_image_width, canvas_image_height);
            }

            data = pdf.save($("#LicenseAppId").val() + "_Form4.pdf");

        });
      }

    function getPDF() {
        debugger;
        var HTML_Width = $("#divPrint").width();
        var HTML_Height = $("#divPrint").height();
        var top_left_margin = 15;
        var PDF_Width = HTML_Width + (top_left_margin * 2);
        var PDF_Height = (PDF_Width * 1.5) + (top_left_margin * 2);
        var canvas_image_width = HTML_Width;
        var canvas_image_height = HTML_Height;

        var totalPDFPages = Math.ceil(HTML_Height / PDF_Height) - 1;


        html2canvas($("#divPrint")[0], { allowTaint: true }).then(function (canvas) {
            debugger;
            canvas.getContext('2d');

            console.log(canvas.height + "  " + canvas.width);

            // var data = canvas.toDataURL();
            var data = canvas.toDataURL("image/JPEG", 1.0);
            var pdf = new jsPDF('p', 'pt', [PDF_Width, PDF_Height]);
            pdf.addImage(data, 'JPEG', top_left_margin, top_left_margin, canvas_image_width, canvas_image_height);


            for (var i = 1; i <= totalPDFPages; i++) {
                pdf.addPage(PDF_Width, PDF_Height);
                pdf.addImage(data, 'JPEG', top_left_margin, -(PDF_Height * i) + (top_left_margin * 4), canvas_image_width, canvas_image_height);
            }
            //data = data.replace('data:image/png;base64,', '');
            data = pdf.output("datauristring").replace('data:application/pdf;base64,', '');
                    //-----------------
                     try {
                    var dt = new Date();
                    var FNID = $("#LicenseAppId").val();
                    var FileName = FNID + "_Form4_" + dt.getDate() + "" + (dt.getMonth() + 1) + "" + dt.getFullYear() + "_" + dt.getHours() + "_" + dt.getMinutes() + "_" + dt.getSeconds() + ".pdf";
                    $("#fName").val(FileName).change();
                    $.ajax({
                        url: "/Licensee/LicenseApplication/SaveNormalPdfFile",
                        data: { base64BinaryStr: data, fileName: $("#fName").val(), ID: $("#LicenseAppId").val(), UpdateIn: "LICENSE_APP" },
                        type: "post",
                        dataType:'json',
                        success: function (msg) {
                            debugger;
                            if (msg == "SUCCESS") {

                                var FPath = '@ViewBag.DSCReadFilePath' + $("#fName").val();
                                var OutPath = "";
                                var Postdata = 'action=signpdf' + "\n" + 'datatosign=' + FPath + '' + "\n" + 'signaction=2' + "\n" + 'outputpath=' + OutPath + '' + "\n" + 'signtype=sign' + "\n" + 'expirycheck=false' + "\n" + 'coordinate=600,100,1300,50' + "\n" + 'issuername=' + "\n" + 'certtype=ALL' + "\n" + 'certclass=0';
                                connection.send(Postdata);
                                connection.onerror = function (error) {
                                    alert('Please check the server connection: ' + error);
                                    alert(error);
                                };

                                connection.onmessage = function (e) { // when DSC is success then following function executed.
                                    debugger;
                                    if (e.data.indexOf("subProtocol") == -1) {

                                        $.ajax(
                                            {
                                                url: "/Licensee/LicenseApplication/CheckVerifyResponse",
                                                type: "POST",
                                                data: { contentType: "pkcs7", signDataBase64Encoded: e.data, responseType: "plain" },
                                                async: false,
                                                success: function (msg) {
                                                    debugger;
                                                    if (msg == "SUCCESS") {

                                                        var FNID = $("#fName").val();
                                                        var LicenseAppId = $("#LicenseAppId").val();
                                                        var signData = e.data;
                                                        $.ajax({
                                                            url:"/Licensee/LicenseApplication/SavePdfFile",
                                                            type: "POST",
                                                            async: false,
                                                            data: { base64BinaryStr: e.data, fileName: FNID, ID: LicenseAppId, UpdateIn: "LICENSE_APP" },
                                                            success: function (msg) {
                                                                if (msg == "SUCCESS") {
                                                                    window.location.href ='@CustomQueryStringHelper.EncryptString("Licensee","Form6","LicenseApplication",new {id=Model.LicenseAppId })';
                                                                }
                                                                else {
                                                                    alert(msg);
                                                                        }
                                                                    }
                                                        });
                                                    }
                                                }
                                            });
                                    }
                                    else {
                                        alert(e.data);
                                    }
                                };
                            }
                            else {
                                alert(msg);

                            }
                        }
                    });
                }
                catch (e) {
                    alert("Your DSC Connection is not working. Please try after some time.");
                }
                    //-------------------------

        });



    }
    //following code is for DSC Signature
    try {
        var connection = new WebSocket('wss://localhost.emudhra.com:8080');

        connection.onopen = function () {
            console.log('Connection Opened');
        };
        connection.onerror = function (error) {
            //  alert('Please check the DSC connection: ' + error);
        };
        connection.onmessage = function (e) {
            if (e.data.indexOf("subProtocol") == -1) {
                //  alert(e.data);
            }
        };
    }
    catch (e) {
        alert("No DSC Connection Found");
    }
    //-----------------------------

</script>
